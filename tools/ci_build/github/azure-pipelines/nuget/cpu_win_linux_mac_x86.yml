parameters:
  AgentPoolWin : 'Win-CPU'
  AgentPoolLinux : 'Linux-CPU'
  AgentPoolMacOS : 'macOS-10.13'

jobs: 
- template: ../win-ci-pipeline.yml
  parameters:
    DoDebugBuild: 'false'
    DoNugetPack : 'true'
    DoCompliance: 'true'
    BuildCommand:  '$(Build.SourcesDirectory)\tools\ci_build\build.py --build_dir $(Build.BinariesDirectory) --skip_submodule_sync --cmake_path $(Build.BinariesDirectory)\cmake\bin\cmake.exe --ctest_path $(Build.BinariesDirectory)\cmake\bin\ctest.exe --use_openmp --build_shared_lib --build_csharp --enable_onnx_tests --test_data_url $(TestDataUrl) --test_data_checksum $(TestDataChecksum)'
    AgentPoolWin : $(AgentPoolWin) 

- template: ../win-x86-ci-pipeline.yml
  parameters:
    DoDebugBuild: 'false'
    DoNugetPack : 'true'
    BuildCommand: '$(Build.SourcesDirectory)\tools\ci_build\build.py --build_dir $(Build.BinariesDirectory) --skip_submodule_sync --cmake_path $(Build.BinariesDirectory)\cmake\bin\cmake.exe --ctest_path $(Build.BinariesDirectory)\cmake\bin\ctest.exe --use_openmp --build_shared_lib  --build_csharp --enable_onnx_tests --test_data_url $(TestDataUrl) --test_data_checksum $(TestDataChecksum) --x86'
    AgentPoolWin : $(AgentPoolWin)


- template: ../linux-ci-pipeline.yml
  parameters:
    DoNugetPack : 'true'
    BuildCommand: 'tools/ci_build/github/linux/run_dockerbuild.sh -o ubuntu16.04 -d cpu -r $(Build.BinariesDirectory)'
    AgentPoolLinux : $(AgentPoolLinux)

- template: ../linux-x86-ci-pipeline.yml
  parameters:
    DoNugetPack : 'true'
    BuildCommand : 'tools/ci_build/github/linux/run_dockerbuild.sh -o ubuntu16.04 -d cpu -r $(Build.BinariesDirectory) -a x86 -x "--x86"'
    AgentPoolLinux : $(AgentPoolLinux)

- template: ../mac-ci-pipeline.yml
  parameters:
    DoNugetPack : 'true'
    AgentPoolMacOS : $(AgentPoolMacOS)

- template: templates/gen_package.yml
- template: packagetests/win.yml
- template: packagetests/linux.yml
- template: packagetests/macos.yml






